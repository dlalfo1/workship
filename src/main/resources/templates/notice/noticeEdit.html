<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
                <!--/* 괄호 안에 이름 바꾸면 페이지 타이틀 정해집니다! */-->
<head th:replace="~{/layout/header::headFrag('공지사항')}"></head>
<script>

  function fnFileCheck(vThis){
  
  	// 최대 크기 10MB
  	let maxSize = 1024 * 1024 * 10;
  	
  	// 첨부된 파일 목록
  	let files = vThis.files;
  	
  	// 첨부된 파일 순회(크기 체크 + 첨부된 파일명 표시)
  	$('#fileList').empty();
  	$.each(files, function(i, file){
  		
  		// 크기 체크
  		if(file.size > maxSize){
  			alert('각 첨부파일의 최대 크기는 10MB입니다.');
  			$(vThis).val('');  // 첨부된 파일을 모두 지운다.
  			$('#fileList').text('첨부 파일의 목록이 이 곳에 표시됩니다');
  			return;
  		}
  		
  		// 첨부된 파일명 표시
  		$('#fileList').append('<div>' + file.name + '</div>');
  		
  	})
  	
  }
  
	function fnRemoveAttach(attachNo){
		if(confirm('이 첨부 파일을 삭제하시겠습니까?') == false){
			return;
		}
		location.href = '@{/notice/removeAttach.do?noticeNo=${notice.notiecNo}&attachNo=}' + attachNo;
	}

  function fnModifyNotice() {
	  $('#frmModify').sumbit();
  }
	
  function fnTempSave() {
	  
  }
  
  function fnList() {
  	location.href = '/board/board.html';
  }
  
  $(function(){
  	$('#content').summernote({
  		width: 1280,
  		height: 1024,
  		lang: 'ko-KR',
  		toolbar: [
  			['style', ['bold', 'italic', 'underline', 'clear']],
  			['font', ['strikethrough', 'superscript', 'subscript']],
  			['fontname', ['fontname']],
  			['color', ['color']],
  			['para', ['ul', 'ol', 'paragraph']],
  			['table', ['table']],
  			['insert', ['link', 'picture', 'video']],
  			['view', ['fullscreen', 'codeview', 'help']]
  		],
  		callbacks: {
  			onImageUpload: function(files){            // summernote 편집기에 이미지를 올리면 해당 이미지의 정보는 function의 매개변수 files(배열)로 전달된다.
  				for(let i = 0; i < files.length; i++) {  // files 배열을 순회하면서 이미지를 하나씩 처리한다.
  					var formData = new FormData();         // 가상 form (주로 ajax 처리에서 사용)
  					formData.append('file', files[i]);     // 가상 form에 추가한 요소
  					$.ajax({                               // 가상 form에 저장된 이미지를 HDD에 저장하고 저장된 경로(매핑)와 이름을 받아오는 ajax
  						contentType: false,                  // ajax을 이용한 파일 첨부에서 사용
  						processData: false,                  // ajax을 이용한 파일 첨부에서 사용
  						type: 'post',
  						url: getContextPath() + '/blog/imageUpload.do',
  						data: formData,
  						dataType: 'json',
  						success: function(resData){          // resData = {"src": "/app13/imageLoad/abcdefg.jpg"}
  							$('#content').summernote('insertImage', resData.src);  // content에 <img src="/app13/imageLoad/abcdefg.jpg"> 태그가 추가된다.
  							                                                       // content에 추가된 img 태그의 src 속성 값은 servlet-context.xml의 resources 태그에 의해서 /storage/summernote/abcdefg.jpg로 처리된다.
  						}
  					})  // ajax
  				}  // for
  			}  // onImageUpload
  		}  // callbacks
  	})
  })
  
  
	
</script>
<body>

  <div class="container-scroller">
    <!--/* 상단바 */-->
    <nav th:replace="~{/layout/common::topbarFrag}"></nav>

    <!--/* 본문영역 */-->
    <div class="container-fluid page-body-wrapper">
      <!--/* 테마설정버튼 영역 */-->
      <div th:replace="~{/layout/common::themeSettingFrag}"></div>   
      <!--/* 사이드바 영역 */-->
      <nav th:replace="~{/layout/sidebar::sidebarFrag}"></nav>
      
      <!--/* 실제 내용 영역 */-->
      <div class="main-panel">
        <div class="content-wrapper">
        
          <div class="board-main">
            <div class="board-title">
             <h3>게시글 수정하기</h3>
            </div>
            
            <hr>
          
            <div class="board-content">
              <form id="frmModify" method="post" enctype="multipart/form-data" th:action="@{/notice/modify.do}">
                <div class="inputTitle">
                  <label for="noticeTitle">제목</label>
                  <div><input type="text" name="noticeTitle" id="noticeTitle" required="required"></div>
                </div>
                <div class="emailId">
                  <label for="emailId">작성자</label>
                  <div><input type="text" name="emailId" id="emailId" th:value=${session.loginId} readonly></div>
                </div>
                <div class="inputText">
                  <textarea id="content" name="content" required="required" style="resize: none;"></textarea>
                </div>
                <div class="attchFile">
                  <label for="files">첨부</label>
                  <input type="file" id="files" name="files" multiple="multiple" onchange="fnFileCheck(this)">
                  <div id="fileList">첨부 파일의 목록이 이 곳에 표시됩니다</div>
                </div>
                <div class="btnWrap">
                  <input type="hidden" name="uploadNo" value="${upload.uploadNo}">
                  <input type="button" class="btn btn-sm btn-primary" value="수정완료" onclick="fnModifyNotice()">
                  <input type="button" class="btn btn-sm btn-light" value="돌아가기" onclick="fnList()"> <!-- 바로 전 목록으로 돌아가기 -->
                </div>
              </form>
              <div class="attachList">
                <div>현재 첨부 목록</div>
                <th:block th:if="${empty noticeFileList">
                  <div>첨부된 파일이 없습니다.</div>
                </th:block>
                <th:block th:if="${not empty noticeFileList">   
                  <div>
                    <th:block th:each="noticeFile:${noticeFileList}">
                      <div>
                        <span th:text="${noticeFile.noticeFileOriginName}"></span>
                        <input type="button" value="삭제" th:onclick="fnRemoveAttach(${noticeFile.noticeFileNo})">
                      </div>
                    </th:block>
                  </div>
                </th:block>
              </div>
            </div> <!--/* board-table 끝나는 지점 */-->
          </div> <!--/* board-main 끝나는 지점 */-->

        </div>  <!--/* content-wrapper 끝나는 지점 */-->
      </div>  <!--/* main-panel 끝나는 지점 */-->      
    </div>  <!--/* page-body-wrapper(사이드바+본문) 끝나는 지점 */-->
  </div>  <!--/* container-scroller(상단바+사이드바+본문) 끝나는 지점 */-->
  
  <!--/* footer 영역 */-->
  <footer th:replace="~{layout/footer::footerFrag}"></footer> 

</body>
</html>