<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
                <!--/* 괄호 안에 이름 바꾸면 페이지 타이틀 정해집니다! */-->
<head th:replace="~{/layout/header::headFrag('workship 출퇴근기록조회')}"></head>
<body>
  <div class="container-scroller">

    <!--/* 상단바 */-->
    <nav th:replace="~{/layout/common::topbarFrag}"></nav>
  
    <!--/* 본문영역 */-->
    <div class="container-fluid page-body-wrapper">
    
      <!--/* 테마설정버튼 영역 */-->
      <div th:replace="~{/layout/common::themeSettingFrag}"></div>   
      <!--/* 사이드바 영역 */-->
      <nav th:replace="~{/layout/sidebar::sidebarFrag}"></nav>
      
      <!--/* 실제 내용 영역 */-->
      <div class="main-panel">
        <div class="content-wrapper">
        
          <!--/* 출근정보 모아보기 */-->
          <div class="row">
          
            <!--/* (끝!) 오늘의 출근정보 */-->
            <div class="col-md-4 stretch-card grid-margin mb-3">
              <div class="card">
                <div class="card-body text-center">
                  <p class="card-title mb-1" th:text="${#calendars.format(#calendars.createNow(), 'yyyy년 MM월 dd일')}"></p>
                  <div class="mb-3">
                    <span class="card-subtitle">현재시간 </span>
                    <span class="card-subtitle" id="nowTime"></span>
                    <script>
                      function clock(){
	                      var today = new Date();
	                      var hours = ('0' + today.getHours()).slice(-2); 
	                      var minutes = ('0' + today.getMinutes()).slice(-2);
	                      var seconds = ('0' + today.getSeconds()).slice(-2);
	                      var time = hours + ':' + minutes + ':' + seconds;
	                      $('#nowTime').text(time);
                      }
                      clock();
                      setInterval(clock, 1000);
                    </script>
                  </div>
                  <div class="row">
                    <div class="col-5">출근시간</div>
                    <div class="col-7 text-primary"><h3 th:text="${#dates.format(attendanceToday?.astarttime, 'HH:mm:ss')}"></h3></div>
                  </div>
                  <div class="row">
                    <div class="col-5">퇴근시간</div>
                    <div class="col-7 text-primary"><h3 th:text="${#dates.format(attendanceToday?.aendtime, 'HH:mm:ss')}"></h3></div>
                  </div>
                  <div class="row">
	                  <div class="col-6">
	                    <input type="button" onclick="fnAStart()" class="btn btn-inverse-primary btn-md" style="width: 100%;" value="출근">
	                  </div>
	                  <div class="col-6 text-center">
	                    <input type="button" onclick="fnAEnd()" class="btn btn-outline-primary btn-md" style="width: 100%;" value="퇴근">
	                  </div>
                  </div>
	                <script th:inline="javascript">
	                  function fnAStart(){
	                    var memberNo = /*[[${session.loginMember.memberNo}]]*/ null;
	                    $.ajax({
	                      type: 'get',
	                      url: '/main/aStart.do',
	                      data: 'memberNo=' + memberNo,
	                      dataType: 'json',
	                      success: function(resData){
	                        var result = resData.result;
	                        if(result == 'fail') {
	                          alert('이미 출근 처리되었습니다.');
	                        } else {
	                          $('#aStartTime').text(result.substr(11, 8));
	                        }
	                      }
	                    })
	                  };
	                  
	                  function fnAEnd(){
	                     var memberNo = /*[[${session.loginMember.memberNo}]]*/ null;
	                     $.ajax({
	                       type: 'get',
	                       url: '/main/aEnd.do',
	                       data: 'memberNo=' + memberNo,
	                       dataType: 'json',
	                       success: function(resData){
	                         var result = resData.result;
	                         if(result == 'noStart') {
	                           alert('출근 처리가 되지 않았습니다.');
	                         } else if(result == 'alreadyEnd'){
	                           alert('이미 퇴근 처리되었습니다.');
	                         } else {
	                           $('#aEndTime').text(result.substr(11, 8));
	                         }
	                       }
	                     })
	                   };
	                </script>
                </div>
              </div>
            </div>
            
            <!--/* 이번달 출근정보 */-->
            <div class="col-md-4 stretch-card grid-margin mb-3">
              <div class="card">
                <div class="card-body">
                  <p class="card-title">이번달 출근 정보</p>
                  <table class="table table-sm table-borderless text-center">
                    <tr>
                      <th>정상</th>
                      <th>지각</th>
                      <th>조퇴</th>
                      <th>결근</th>
                    </tr>
                    <tr>
                      <td><h3 class="text-secondary">0</h3></td>
                      <td><h3 class="text-secondary">0</h3></td>
                      <td><h3 class="text-secondary">0</h3></td>
                      <td><h3 class="text-secondary">0</h3></td>
                    </tr>
                    <tr>
                      <td colspan="4"></td>
                    </tr>
                    <tr>
                      <th colspan="2">총 근무시간</th>
                      <td colspan="2"><h3 class="text-secondary">0시간 0분</h3></td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
            
            <!--/* 검색 조건 설정 */-->
            <div class="col-md-4 stretch-card grid-margin mb-3">
              <div class="card">
                <div class="card-body">
                  <p class="card-title"></p>
                </div>
              </div>
            </div>

          </div>
          
          <!--/* 리스트 뿌려줄 테이블 */-->
          <div class="row">
						<div class="col-md-12 stretch-card grid-margin">
							<div class="card">
							  <div class="card-body">
								  <p class="card-title">출퇴근 기록</p>
									<table class="table table-sm table-striped text-center">
										<thead>
										  <tr>
											  <th width="20%">날짜</th>
											  <th width="20%">출근시간</th>
											  <th width="20%">퇴근시간</th>
											  <th width="20%">근무시간</th>
											  <th width="20%">근태</th>
										  </tr>
										</thead>
										<tbody id="attendanceListTableBody">
										  <th:block th:each="attendance:${attendanceList}">
										    <tr>
										      <td th:text="${#dates.format(attendance?.date, 'YYYY-MM-dd')}"></td>
										      <td th:text="${#dates.format(attendance?.astarttime, 'HH:mm:ss')}"></td>
										      <td th:text="${#dates.format(attendance?.aendtime, 'HH:mm:ss')}"></td>
										      <td th:text="${#dates.format(attendance?.worktime, 'HH:mm:ss')}"></td>
										      <td th:text="${attendance?.attendance}"></td>
										    </tr>
									    </th:block>
										</tbody>
									</table>
									<script>
									 
									</script>
							  </div>
							</div>
						</div>
          </div>
          
        </div>  <!--/* content-wrapper 끝나는 지점 */-->
      </div>  <!--/* main-panel 끝나는 지점 */-->      
    </div>  <!--/* page-body-wrapper(사이드바+본문) 끝나는 지점 */-->
  </div>  <!--/* container-scroller(상단바+사이드바+본문) 끝나는 지점 */-->
  
  <!--/* footer 영역 */-->
  <footer th:replace="~{layout/footer::footerFrag}"></footer> 

</body>
</html>